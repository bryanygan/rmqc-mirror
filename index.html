<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="origin">
  <title>Mirror Photo Galleries</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f8f8f8;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    .album-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-bottom: 40px;
    }
    .album-card {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      overflow: hidden;
      text-align: center;
      width: 200px;
      transition: transform 0.2s;
    }
    .album-card:hover {
      transform: scale(1.05);
    }
    .album-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }
    .album-card h2 {
      font-size: 1rem;
      margin: 10px 0;
      color: #333;
    }
    .album-card a {
      color: inherit;
      text-decoration: none;
    }
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin: 40px 0;
      flex-wrap: wrap;
    }
    .pagination a,
    .pagination span {
      padding: 8px 12px;
      background: #fff;
      border-radius: 4px;
      text-decoration: none;
      color: #333;
      border: 1px solid #ddd;
      transition: all 0.2s;
    }
    .pagination a:hover {
      background: #49bc85;
      color: #fff;
      border-color: #49bc85;
    }
    .pagination .current {
      background: #49bc85;
      color: #fff;
      border-color: #49bc85;
      font-weight: bold;
    }
    .pagination .disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }
    .page-info {
      text-align: center;
      color: #666;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <h1>Photo Galleries</h1>
  <div class="page-info" id="page-info"></div>
  <div class="album-container" id="album-container">
    <!-- Albums will be injected here -->
  </div>
  <div class="pagination" id="pagination">
    <!-- Pagination will be injected here -->
  </div>
  <script>
    const ALBUMS_PER_PAGE = 120; // Match Yupoo's pagination

    // Get current page from URL
    const params = new URLSearchParams(window.location.search);
    const currentPage = parseInt(params.get('page')) || 1;

    fetch('albums.json')
      .then(response => response.json())
      .then(data => {
        const allAlbums = data.albums.filter(album => album.cover && album.title);
        const totalAlbums = allAlbums.length;
        const totalPages = Math.ceil(totalAlbums / ALBUMS_PER_PAGE);

        // Calculate start and end indices for current page
        const startIndex = (currentPage - 1) * ALBUMS_PER_PAGE;
        const endIndex = Math.min(startIndex + ALBUMS_PER_PAGE, totalAlbums);
        const albumsOnPage = allAlbums.slice(startIndex, endIndex);

        // Display albums for current page
        const container = document.getElementById('album-container');
        albumsOnPage.forEach(album => {
          const card = document.createElement('div');
          card.className = 'album-card';
          card.innerHTML = `
            <a href="gallery.html?id=${encodeURIComponent(album.id)}">
              <img src="${album.cover}" alt="${album.title}" referrerpolicy="origin" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22150%22%3E%3Crect fill=%22%23ddd%22 width=%22200%22 height=%22150%22/%3E%3Ctext fill=%22%23999%22 font-family=%22Arial%22 font-size=%2214%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22%3ENo Image%3C/text%3E%3C/svg%3E'">
              <h2>${album.title}</h2>
            </a>
          `;
          container.appendChild(card);
        });

        // Display page info
        const pageInfo = document.getElementById('page-info');
        pageInfo.textContent = `Showing ${startIndex + 1}-${endIndex} of ${totalAlbums} albums (Page ${currentPage} of ${totalPages})`;

        // Create pagination controls
        const pagination = document.getElementById('pagination');

        // Previous button
        if (currentPage > 1) {
          const prevLink = document.createElement('a');
          prevLink.href = currentPage === 2 ? 'index.html' : `index.html?page=${currentPage - 1}`;
          prevLink.textContent = '← Previous';
          pagination.appendChild(prevLink);
        } else {
          const prevSpan = document.createElement('span');
          prevSpan.className = 'disabled';
          prevSpan.textContent = '← Previous';
          pagination.appendChild(prevSpan);
        }

        // Page numbers
        const maxVisiblePages = 10;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

        // Adjust if we're near the end
        if (endPage - startPage < maxVisiblePages - 1) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        // First page link
        if (startPage > 1) {
          const firstLink = document.createElement('a');
          firstLink.href = 'index.html';
          firstLink.textContent = '1';
          pagination.appendChild(firstLink);

          if (startPage > 2) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.style.cursor = 'pointer';
            ellipsis.title = 'Click to jump to page';
            ellipsis.addEventListener('click', () => {
              const input = document.createElement('input');
              input.type = 'number';
              input.min = '1';
              input.max = totalPages;
              input.value = '';
              input.placeholder = 'Page';
              input.style.width = '60px';
              input.style.padding = '6px 8px';
              input.style.border = '1px solid #ddd';
              input.style.borderRadius = '4px';
              input.style.textAlign = 'center';

              input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                  const pageNum = parseInt(input.value);
                  if (pageNum >= 1 && pageNum <= totalPages) {
                    window.location.href = pageNum === 1 ? 'index.html' : `index.html?page=${pageNum}`;
                  } else {
                    alert(`Please enter a page number between 1 and ${totalPages}`);
                  }
                }
              });

              input.addEventListener('blur', () => {
                ellipsis.style.display = 'inline-block';
                input.remove();
              });

              ellipsis.style.display = 'none';
              ellipsis.parentNode.insertBefore(input, ellipsis);
              input.focus();
            });
            pagination.appendChild(ellipsis);
          }
        }

        // Page number links
        for (let i = startPage; i <= endPage; i++) {
          if (i === currentPage) {
            const currentSpan = document.createElement('span');
            currentSpan.className = 'current';
            currentSpan.textContent = i;
            pagination.appendChild(currentSpan);
          } else {
            const pageLink = document.createElement('a');
            pageLink.href = i === 1 ? 'index.html' : `index.html?page=${i}`;
            pageLink.textContent = i;
            pagination.appendChild(pageLink);
          }
        }

        // Last page link
        if (endPage < totalPages) {
          if (endPage < totalPages - 1) {
            const ellipsis = document.createElement('span');
            ellipsis.textContent = '...';
            ellipsis.style.cursor = 'pointer';
            ellipsis.title = 'Click to jump to page';
            ellipsis.addEventListener('click', () => {
              const input = document.createElement('input');
              input.type = 'number';
              input.min = '1';
              input.max = totalPages;
              input.value = '';
              input.placeholder = 'Page';
              input.style.width = '60px';
              input.style.padding = '6px 8px';
              input.style.border = '1px solid #ddd';
              input.style.borderRadius = '4px';
              input.style.textAlign = 'center';

              input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                  const pageNum = parseInt(input.value);
                  if (pageNum >= 1 && pageNum <= totalPages) {
                    window.location.href = pageNum === 1 ? 'index.html' : `index.html?page=${pageNum}`;
                  } else {
                    alert(`Please enter a page number between 1 and ${totalPages}`);
                  }
                }
              });

              input.addEventListener('blur', () => {
                ellipsis.style.display = 'inline-block';
                input.remove();
              });

              ellipsis.style.display = 'none';
              ellipsis.parentNode.insertBefore(input, ellipsis);
              input.focus();
            });
            pagination.appendChild(ellipsis);
          }

          const lastLink = document.createElement('a');
          lastLink.href = `index.html?page=${totalPages}`;
          lastLink.textContent = totalPages;
          pagination.appendChild(lastLink);
        }

        // Next button
        if (currentPage < totalPages) {
          const nextLink = document.createElement('a');
          nextLink.href = `index.html?page=${currentPage + 1}`;
          nextLink.textContent = 'Next →';
          pagination.appendChild(nextLink);
        } else {
          const nextSpan = document.createElement('span');
          nextSpan.className = 'disabled';
          nextSpan.textContent = 'Next →';
          pagination.appendChild(nextSpan);
        }
      })
      .catch(error => {
        console.error('Error loading album list:', error);
        document.getElementById('page-info').textContent = 'Error loading albums';
      });
  </script>
</body>
</html>